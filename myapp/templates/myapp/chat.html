{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>AI Chat</h2>
    <div id="chat-box" style="border:1px solid #ccc; padding:10px; height:300px; overflow-y:auto; background:#fafafa;">
    </div>
    <form id="chat-form" class="mt-2">
        <div class="input-group">
            <input type="text" id="chat-input" class="form-control" placeholder="Type your message..."
                autocomplete="off" required>
            <button type="submit" class="btn btn-primary">Send</button>
        </div>
    </form>
</div>
<script>
    document.getElementById('chat-form').onsubmit = async function (e) {
        e.preventDefault();
        const input = document.getElementById('chat-input');
        const chatBox = document.getElementById('chat-box');
        const userMsg = input.value;
        chatBox.innerHTML += `<div><b>You:</b> ${userMsg}</div>`;
        input.value = '';
        chatBox.innerHTML += `<div id="ai-typing"><b>AI:</b> <span class="text-muted">typing...</span></div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
        try {
            const response = await fetch("{% url 'chat_api' %}", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: userMsg })
            });
            const data = await response.json();
            document.getElementById('ai-typing').innerHTML = `<b>AI:</b> ${data.reply}`;
        } catch (err) {
            document.getElementById('ai-typing').innerHTML = `<b>AI:</b> <span class="text-danger">Sorry, there was an error. Please try again.</span>`;
        }
        chatBox.scrollTop = chatBox.scrollHeight;
    };
</script>
{% endblock %}